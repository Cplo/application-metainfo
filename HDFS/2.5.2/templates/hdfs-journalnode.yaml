<#assign
  registryServer=dependencies.REGISTRY.roles['REGISTRY_SERVER'][0].hostname
  registryPort=dependencies.REGISTRY[registryServer]['registry.port']
  >
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  labels:
    name: hadoop-hdfs-journalnode-${service.sid}-${localhostname}
  name: hadoop-hdfs-journalnode-${service.sid}-${localhostname}
  namespace: default
spec:
  replicas: 3
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  template:
    metadata:
      labels:
        name: hadoop-hdfs-journalnode-${service.sid}-${localhostname}
    spec:
      containers:
      - args:
        - bootstrap.sh
        - journalnode
        env:
          - name: KRB_ENABLE
            value: "false"
          - name: HADOOP_PID_DIR
            value: /var/run/${service.sid}/
          - name: HADOOP_CONF_DIR
            value: /etc/${service.sid}/conf
          - name: DATA_DIRS
            value: /hadoop/journal
          - name: HDFS_HA
            value: "true"
          - name: HEAP_SIZE
            value: ${service['journalnode.memory']}m
        image: ${registryServer}:${registryPort}/jenkins/hdfs
        imagePullPolicy: Always
        name: hadoop-hdfs-journalnode-${service.sid}-${localhostname}
        volumeMounts:
        - mountPath: /etc/${service.sid}/conf
          name: hdfs
        - mountPath: /var/run/hadoop-common
          name: socketdir
        - mountPath: /var/transwarp/logs
          name: log
        - mountPath: /hadoop/journal
          name: journaldir
      volumes:
      - hostPath:
          path: /var/log/${service.sid}
        name: log
      - hostPath:
          path: /etc/${service.sid}/conf
        name: hdfs
      - hostPath:
          path: /root/docker/common
        name: socketdir
      - hostPath:
          path: /hadoop/journal
        name: journaldir
      hostNetwork: true
